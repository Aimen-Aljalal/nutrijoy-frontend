(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[199],{3491:(e,t,a)=>{"use strict";a.d(t,{V:()=>l});let l=e=>e?e.startsWith("http")?e:"https://nutrijoy-backend.onrender.com".concat(e):"/placeholder.png"},5695:(e,t,a)=>{"use strict";var l=a(8999);a.o(l,"usePathname")&&a.d(t,{usePathname:function(){return l.usePathname}}),a.o(l,"useRouter")&&a.d(t,{useRouter:function(){return l.useRouter}}),a.o(l,"useSearchParams")&&a.d(t,{useSearchParams:function(){return l.useSearchParams}})},7036:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});var l=a(5155),r=a(2115),n=a(5695),o=a(3491);function s(){let e=(0,n.useRouter)(),[t,a]=(0,r.useState)([]),[s,i]=(0,r.useState)(null),[c,d]=(0,r.useState)(""),[u,m]=(0,r.useState)(null),[h,g]=(0,r.useState)([]),[p,b]=(0,r.useState)(null),[x,y]=(0,r.useState)(!0),[f,j]=(0,r.useState)(""),[w,N]=(0,r.useState)(!1),[v,k]=(0,r.useState)(""),[C,S]=(0,r.useState)(""),[E,P]=(0,r.useState)(""),F=async e=>{let t=await fetch("https://nutrijoy-backend.onrender.com/api/dailyConsumption/today",{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error("Failed to fetch daily meals");g((await t.json()).meals||[])};(0,r.useEffect)(()=>{(async()=>{let t=localStorage.getItem("token");if(!t)return e.push("/login");try{let e=await fetch("https://nutrijoy-backend.onrender.com/api/user/profile",{headers:{Authorization:"Bearer ".concat(t)}});if(!e.ok)throw Error("Failed to fetch user");let l=await e.json();b(l),await F(t);let r=await fetch("https://nutrijoy-backend.onrender.com/api/meals/MealPlaning",{headers:{Authorization:"Bearer ".concat(t)}});if(!r.ok)throw Error("Failed to fetch meals");let n=await r.json();a(n)}catch(e){console.error(e)}finally{y(!1)}})()},[e]);let _=async()=>{if(!u||!s)return;let e=localStorage.getItem("token");try{if(!(await fetch("https://nutrijoy-backend.onrender.com/api/dailyConsumption/add",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({mealId:s._id,quantity:parseFloat(c),calories:parseFloat(u)})})).ok)throw Error("Failed to save meal");await F(e),j("Meal added successfully!"),i(null),m(null),d(""),setTimeout(()=>j(""),2500)}catch(e){console.error(e),j("")}},A=async()=>{if(!v||!C||!E)return;let e=localStorage.getItem("token");try{if(!(await fetch("https://nutrijoy-backend.onrender.com/api/dailyConsumption/add",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({mealId:null,customName:v,quantity:parseFloat(C),calories:parseFloat(E)})})).ok)throw Error("Failed to save custom meal");await F(e),j("Custom meal added successfully!"),k(""),S(""),P(""),N(!1),setTimeout(()=>j(""),2500)}catch(e){console.error(e)}},z=async()=>{let e=localStorage.getItem("token");if(e)try{if(!(await fetch("https://nutrijoy-backend.onrender.com/api/dailyConsumption/finalize",{method:"PATCH",headers:{Authorization:"Bearer ".concat(e)}})).ok)throw Error("Failed to finalize day");alert("Today's meals added to history!"),g([])}catch(e){console.error(e),alert("Error finalizing day")}},B=async e=>{let t=localStorage.getItem("token");try{if(!(await fetch("hhttps://nutrijoy-backend.onrender.com/api/dailyConsumption/delete/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(t)}})).ok)throw Error("Failed to delete meal");g(t=>t.filter(t=>t._id!==e))}catch(e){console.error(e),alert("Error deleting meal")}};if(x)return(0,l.jsx)("p",{children:"Loading..."});let T=h.reduce((e,t)=>e+t.calories,0),I=(e=>{var t,a,l;if(!e)return 0;let r=Number(e.weight_kg),n=Number(e.height_cm),o=Number(e.age),s=null==(t=e.gender)?void 0:t.toLowerCase(),i=(null==(a=e.activity_level)?void 0:a.toLowerCase())||"sedentary",c=0;"male"===s?c=10*r+6.25*n-5*o+5:"female"===s&&(c=10*r+6.25*n-5*o-161);let d=1.2;"light"===i?d=1.375:"moderate"===i?d=1.55:"active"===i?d=1.725:"very active"===i&&(d=1.9);let u=c*d,m=(null==(l=e.goal)?void 0:l.toLowerCase())||"maintain weight";return"lose weight"===m?u*=.8:"gain weight"===m&&(u*=1.2),Math.round(u)})(p);return(0,l.jsxs)("div",{className:"p-6",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Meal Planning"}),(0,l.jsxs)("p",{className:"mb-4 font-semibold",children:["Consumed today: ",T," kcal | Remaining: ",I-T," ","kcal"]}),f&&(0,l.jsx)("div",{className:"mb-4 text-green-700 font-bold text-center bg-green-100 p-2 rounded",children:f}),h.length>0&&(0,l.jsxs)("div",{className:"mb-6",children:[(0,l.jsx)("h2",{className:"font-semibold mb-2",children:"Today's Meals"}),(0,l.jsx)("ul",{className:"space-y-2",children:h.map(e=>{var t;return(0,l.jsxs)("li",{className:"flex justify-between bg-gray-100 p-2 rounded",children:[(0,l.jsx)("span",{children:(null==(t=e.mealId)?void 0:t.name)?"".concat(e.mealId.name," - ").concat(e.calories," kcal"):"".concat(e.name," - ").concat(e.calories," kcal")}),(0,l.jsx)("button",{onClick:()=>B(e._id),className:"text-red-600 hover:underline",children:"Delete"})]},e._id)})})]}),h.length>0&&(0,l.jsx)("button",{onClick:z,className:"mt-4 mr-3 ml-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-500",children:"Done"}),(0,l.jsx)("button",{onClick:()=>N(!0),className:"mb-6 px-4 py-2 bg-purple-700 text-white rounded-lg hover:bg-purple-600",children:"Add Custom Meal"}),(0,l.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:t.map(e=>(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-4 flex flex-col items-center",children:[e.imageUrl&&(0,l.jsx)("img",{src:(0,o.V)(e.imageUrl),alt:e.name,className:"w-32 h-32 object-cover rounded-md mb-4"}),(0,l.jsx)("h2",{className:"text-lg font-semibold",children:e.name}),(0,l.jsx)("p",{className:"text-sm text-gray-600 capitalize",children:e.category}),(0,l.jsxs)("p",{className:"text-sm",children:[e.baseQuantityValue," ",e.baseQuantityUnit," ="," ",e.caloriesPerBase," Cal"]}),(0,l.jsx)("button",{onClick:()=>{i(e),d(""),m(null)},className:"mt-3 px-4 py-2 bg-green-700 text-white rounded-lg hover:bg-green-600",children:"Add"})]},e._id))}),s&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-lg w-96",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-4",children:s.name}),(0,l.jsxs)("p",{className:"mb-2",children:[s.baseQuantityValue," ",s.baseQuantityUnit," ="," ",s.caloriesPerBase," Cal"]}),(0,l.jsx)("input",{type:"number",placeholder:"Enter amount in ".concat(s.baseQuantityUnit),value:c,onChange:e=>d(e.target.value),className:"border p-2 w-full rounded mb-4"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{onClick:()=>{!(!c||isNaN(c))&&s&&m((s.caloriesPerBase/s.baseQuantityValue*parseFloat(c).toFixed(2)).toFixed(2))},className:"px-4 py-2 bg-green-700 text-white rounded-lg hover:bg-green-600",children:"Calculate"}),u&&(0,l.jsx)("button",{onClick:_,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-500",children:"Add to daily"})]}),u&&(0,l.jsxs)("p",{className:"mt-4 font-semibold",children:["Calories: ",u]}),(0,l.jsx)("button",{onClick:()=>i(null),className:"mt-4 px-4 py-2 bg-gray-300 rounded-lg hover:bg-gray-400",children:"Close"})]})}),w&&(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-lg w-96",children:[(0,l.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Add Custom Meal"}),(0,l.jsx)("input",{type:"text",placeholder:"Meal name",value:v,onChange:e=>k(e.target.value),className:"border p-2 w-full rounded mb-3"}),(0,l.jsx)("input",{type:"number",placeholder:"Quantity (e.g. grams)",value:C,onChange:e=>S(e.target.value),className:"border p-2 w-full rounded mb-3"}),(0,l.jsx)("input",{type:"number",placeholder:"Calories",value:E,onChange:e=>P(e.target.value),className:"border p-2 w-full rounded mb-4"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("button",{onClick:A,className:"px-4 py-2 bg-green-700 text-white rounded-lg hover:bg-green-600",children:"Save"}),(0,l.jsx)("button",{onClick:()=>N(!1),className:"px-4 py-2 bg-gray-300 rounded-lg hover:bg-gray-400",children:"Cancel"})]})]})})]})}},7578:(e,t,a)=>{Promise.resolve().then(a.bind(a,7036))}},e=>{e.O(0,[441,964,358],()=>e(e.s=7578)),_N_E=e.O()}]);